<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –ë–ª–æ–∫–∏</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Orbitron', 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      overflow: hidden;
      user-select: none;
      position: relative;
      background: #000;
      width: 100vw;
      height: 100vh;
    }

    /* –§–æ–Ω—ã –ª–æ–∫–∞—Ü–∏–π */
    #location-space, #location-lava, #location-ice, #location-bio {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s;
    }
    #location-space.active, #location-lava.active, #location-ice.active, #location-bio.active {
      opacity: 1;
      pointer-events: auto;
    }

    #location-cyber {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s;
    }
    #location-cyber.active {
      opacity: 1;
      pointer-events: auto;
    }
    #cyberGrid {
      position: absolute;
      top: 0;
      left: 0;
      width: 200%;
      height: 200%;
      background: 
        linear-gradient(rgba(76, 0, 130, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(76, 0, 130, 0.1) 1px, transparent 1px);
      background-size: 40px 40px;
      transform: translate(-25%, -25%);
      animation: cyberMove 20s linear infinite;
    }
    @keyframes cyberMove {
      0% { transform: translate(-25%, -25%) scale(1); }
      100% { transform: translate(-25%, -25%) scale(1.2); }
    }

    /* UI */
    #header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      text-align: center;
      z-index: 20;
      padding: 12px 60px 12px 0;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid;
      background: rgba(0, 0, 0, 0.5);
    }
    #gameTitle { 
      margin: 0; 
      font-size: 1.4em; 
      color: white;
    }

    /* HUD */
    #coins, #clickPowerInfo, #speedInfo, #blockLevelInfo, #blockHealthInfo, #helperTimer {
      position: absolute;
      left: 15px;
      font-size: 0.8em;
      z-index: 25;
      text-shadow: 0 0 3px;
      color: white;
    }
    #coins { top: 15px; color: #d7ccc8; text-shadow: 0 0 4px rgba(215,204,200,0.7); }
    #clickPowerInfo { top: 35px; color: #a0d2ff; text-shadow: 0 0 3px rgba(160,210,255,0.6); }
    #speedInfo { top: 55px; color: #ffab91; text-shadow: 0 0 3px rgba(255,171,145,0.6); }
    #blockLevelInfo { top: 75px; color: #bb86fc; text-shadow: 0 0 3px rgba(187,134,252,0.6); }
    #blockHealthInfo { top: 95px; color: #ffcc00; text-shadow: 0 0 3px rgba(255,204,0,0.6); }
    #helperTimer { top: 115px; color: #69f0ae; text-shadow: 0 0 3px rgba(105,240,174,0.6); }

    #levelInfo {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 1.1em;
      z-index: 25;
      color: white;
    }
    
    #gameArea {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 5;
    }
    
    .moving-block {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      user-select: none;
      font-weight: bold;
      font-size: 0.9em;
      font-family: 'Orbitron', monospace;
      transition: transform 0.1s;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
      overflow: hidden;
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç —Ç—Ä–µ—â–∏–Ω –Ω–∞ –±–ª–æ–∫–µ */
    .crack-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background-image: 
        radial-gradient(circle at 30% 30%, transparent 60%, rgba(0,0,0,0.3) 65%),
        radial-gradient(circle at 70% 70%, transparent 60%, rgba(0,0,0,0.3) 65%),
        radial-gradient(circle at 50% 20%, transparent 60%, rgba(0,0,0,0.3) 65%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .crack-1 { opacity: 0.3; }
    .crack-2 { opacity: 0.6; }
    .crack-3 { opacity: 0.9; }

    #levelAnnounce {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5em;
      font-weight: bold;
      z-index: 40;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      color: white;
      text-shadow: 0 0 10px rgba(0,0,0,0.8);
    }

    .upgrade-btn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border: none;
      border-radius: 50%;
      font-size: 1.6em;
      cursor: pointer;
      z-index: 30;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.1s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .upgrade-btn:active { transform: scale(0.92); }
    #upgradeClickBtn { bottom: 90px; }
    #upgradeSlowBtn { bottom: 20px; }
    #upgradeHelperBtn { bottom: 160px; }

    .upgrade-btn.btn-available { 
      background: #4CAF50; 
      color: white; 
    }
    
    .upgrade-btn.btn-unavailable { 
      background: #666; 
      color: #ccc; 
      cursor: not-allowed; 
      opacity: 0.7;
    }

    .tooltip {
      position: absolute;
      bottom: 80px;
      right: 20px;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.85em;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      z-index: 35;
    }

    #pauseBtn {
      position: absolute;
      top: 12px;
      right: 20px;
      padding: 6px 12px;
      border: 1px solid;
      border-radius: 6px;
      font-size: 0.9em;
      cursor: pointer;
      z-index: 30;
      background: rgba(0, 0, 0, 0.5);
      color: white;
    }

    #particlesCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 6;
    }

    .damage-text {
      position: absolute;
      font-size: 1.1em;
      font-weight: bold;
      font-family: 'Orbitron', monospace;
      pointer-events: none;
      z-index: 15;
      opacity: 1;
      transition: transform 0.5s, opacity 0.5s;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }

    /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–ô */
    .combo-text {
      position: absolute;
      font-size: 1.8em;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 0 0 10px #ff6b00, 0 0 20px #ff6b00;
      pointer-events: none;
      z-index: 15;
      animation: comboPop 0.5s ease-out;
      font-family: 'Orbitron', monospace;
    }

    @keyframes comboPop {
      0% { transform: scale(0.5); opacity: 0; }
      70% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    .reward-text {
      position: absolute;
      font-size: 1.3em;
      font-weight: bold;
      color: #d7ccc8;
      pointer-events: none;
      z-index: 15;
      animation: rewardFloat 1.5s ease-out;
      font-family: 'Orbitron', monospace;
    }

    @keyframes rewardFloat {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-50px); opacity: 0; }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–º–æ—â–Ω–∏–∫–∞ */
    .helper {
      position: absolute;
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #69f0ae, #00e676);
      border-radius: 50%;
      z-index: 12;
      pointer-events: none;
      box-shadow: 0 0 15px #69f0ae;
      animation: helperFloat 3s ease-in-out infinite;
    }

    @keyframes helperFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .helper-beam {
      position: absolute;
      width: 3px;
      background: linear-gradient(to top, transparent, #69f0ae);
      z-index: 11;
      pointer-events: none;
      animation: beamPulse 0.5s ease-out;
    }

    @keyframes beamPulse {
      0% { height: 0; opacity: 1; }
      100% { height: 100px; opacity: 0; }
    }

    /* –≠–ö–†–ê–ù–´ */
    #welcomeScreen, #gameOverScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      color: white;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }
    
    #welcomeScreen { 
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    }
    
    #welcomeScreen h2 {
      font-size: 2em;
      margin-bottom: 20px;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 10px rgba(187, 134, 252, 0.7);
    }
    
    #welcomeScreen p {
      max-width: 90%;
      text-align: center;
      margin: 10px 0;
      line-height: 1.5;
    }
    
    .btn {
      padding: 12px 30px;
      margin-top: 20px;
      font-size: 1.1em;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      transition: transform 0.1s;
    }
    
    .btn:active {
      transform: scale(0.95);
    }

    #gameOverScreen {
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(5px);
      display: none;
    }
    
    #gameOverScreen h2 {
      font-size: 2.2em;
      margin-bottom: 20px;
      font-family: 'Orbitron', sans-serif;
      color: #ff4444;
    }
    
    #finalScore { font-size: 1.4em; margin-bottom: 20px; color: #ffcc00; }
    
    #restartBtn, #shareBtn {
      padding: 10px 24px;
      margin: 8px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      transition: transform 0.1s;
    }
    
    #restartBtn:active, #shareBtn:active {
      transform: scale(0.95);
    }
    
    #restartBtn { background: #4CAF50; color: white; }
    #shareBtn { background: #00c853; color: white; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- –õ–æ–∫–∞—Ü–∏–∏ —Å Canvas -->
  <div id="location-space" class="location active">
    <canvas id="starsCanvas"></canvas>
  </div>
  <div id="location-lava" class="location">
    <canvas id="lavaCanvas"></canvas>
  </div>
  <div id="location-ice" class="location">
    <canvas id="iceCanvas"></canvas>
  </div>
  <div id="location-bio" class="location">
    <canvas id="bioCanvas"></canvas>
  </div>
  <div id="location-cyber" class="location">
    <div id="cyberGrid"></div>
  </div>

  <!-- UI -->
  <div id="header">
    <h2 id="gameTitle">üåå –ö–æ—Å–º–æ—Å</h2>
  </div>
  
  <div id="coins">–ö–∞–º—É—à–∫–∏: 0</div>
  <div id="clickPowerInfo">–°–∏–ª–∞: 1</div>
  <div id="speedInfo">–°–∫–æ—Ä–æ—Å—Ç—å: 30</div>
  <div id="blockLevelInfo">–ë–ª–æ–∫: ‚Äî</div>
  <div id="blockHealthInfo">–û—Å—Ç–∞–ª–æ—Å—å: ‚Äî</div>
  <div id="helperTimer">–ü–æ–º–æ—â–Ω–∏–∫: ‚Äî</div>

  <div id="levelInfo">–£—Ä–æ–≤–µ–Ω—å: ‚Äî</div>
  <button id="pauseBtn">‚è∏ –ü–∞—É–∑–∞</button>

  <div id="gameArea"></div>
  <div id="levelAnnounce"></div>

  <button id="upgradeClickBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-hammer"></i>
  </button>
  <button id="upgradeSlowBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-anchor"></i>
  </button>
  <button id="upgradeHelperBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-robot"></i>
  </button>
  <div id="tooltip" class="tooltip"></div>

  <canvas id="particlesCanvas"></canvas>

  <!-- –ó–≤—É–∫–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
  <audio id="clickSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" type="audio/wav">
  </audio>
  <audio id="breakSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" type="audio/wav">
  </audio>
  <audio id="upgradeSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" type="audio/wav">
  </audio>
  <audio id="comboSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" type="audio/wav">
  </audio>
  <audio id="helperSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" type="audio/wav">
  </audio>

  <div id="welcomeScreen">
    <h2>üåå –ö–û–°–ú–ò–ß–ï–°–ö–ò–ï –ë–õ–û–ö–ò</h2>
    <p>–†–∞–∑—Ä—É—à–∞–π—Ç–µ –≤–æ—Å—Ö–æ–¥—è—â–∏–µ –±–ª–æ–∫–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ <strong>–∫–∞–º—É—à–∫–∏</strong>!</p>
    <p>–ö–∞–∂–¥—ã–π –±–ª–æ–∫ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–¥–∞—Ä–æ–≤ –¥–ª—è —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è.</p>
    <p><strong>–£–ª—É—á—à–µ–Ω–∏—è:</strong></p>
    <p>üî® <strong>–°–∏–ª–∞ —É–¥–∞—Ä–∞</strong> ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–Ω –∑–∞ —É–¥–∞—Ä</p>
    <p>‚öì <strong>–Ø–∫–æ—Ä—å</strong> ‚Äî –∑–∞–º–µ–¥–ª—è–µ—Ç –±–ª–æ–∫–∏</p>
    <p>ü§ñ <strong>–ü–æ–º–æ—â–Ω–∏–∫</strong> ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞—Ç–∞–∫—É–µ—Ç –±–ª–æ–∫–∏</p>
    <p>üî• <strong>–ö–æ–º–±–æ-—Å–∏—Å—Ç–µ–º–∞</strong> ‚Äî —Ä–∞–∑—Ä—É—à–∞–π—Ç–µ –±–ª–æ–∫–∏ –±—ã—Å—Ç—Ä–æ –¥–ª—è –±–æ–Ω—É—Å–æ–≤!</p>
    <button class="btn">–ù–∞—á–∞—Ç—å –¥–æ–±—ã—á—É</button>
  </div>

  <div id="gameOverScreen">
    <h2>–î–û–ë–´–ß–ê –ü–†–ï–†–í–ê–ù–ê!</h2>
    <div id="finalScore">–ú–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å: ‚Äî</div>
    <button id="restartBtn">–ù–æ–≤–∞—è –¥–æ–±—ã—á–∞</button>
    <button id="shareBtn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
  </div>

  <script>
    // === –í–´–°–û–ö–û–ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø ===

    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –î–û –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    let coins = 0;
    let currentLevel = 1;
    let maxLevelReached = 0;
    const baseHealth = 8;
    const healthMultiplier = 1.15;
    let clickPower = 1;
    let clickUpgradeLevel = 0;
    const baseClickUpgradeCost = 80;
    let slowBonus = 0;
    const slowCost = 2000;
    let paused = false;
    let gameActive = false;
    let currentLocation = 'space';
    let currentBlockHealth = 0;
    let currentBlock = null;
    let blockSpeed = 30;

    // 2. –ö–æ–º–±–æ-—Å–∏—Å—Ç–µ–º–∞
    let comboCount = 0;
    let lastDestroyTime = 0;
    const COMBO_TIME_WINDOW = 2000;

    // 3. –°–∏—Å—Ç–µ–º–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞
    let helperActive = false;
    let helperTimeLeft = 0;
    const helperDuration = 60000; // 1 –º–∏–Ω—É—Ç–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
    const helperCost = 1500;
    let helperInterval;

    // 4. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
    const gameMetrics = {
        startTime: Date.now(),
        blocksDestroyed: 0,
        upgradesBought: 0,
        totalClicks: 0,
        sessions: parseInt(localStorage.getItem('gameSessions') || '0') + 1
    };

    // 5. Canvas –∞–Ω–∏–º–∞—Ü–∏–∏ —Ñ–æ–Ω–æ–≤
    let stars = [];
    let lavaParticles = [];
    let snowflakes = [];
    let bioDots = [];

    // 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–æ–ª—É—á–µ–Ω–∏–µ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const coinsDisplay = document.getElementById("coins");
        const clickPowerDisplay = document.getElementById("clickPowerInfo");
        const speedDisplay = document.getElementById("speedInfo");
        const blockLevelDisplay = document.getElementById("blockLevelInfo");
        const blockHealthDisplay = document.getElementById("blockHealthInfo");
        const helperTimerDisplay = document.getElementById("helperTimer");
        const levelInfo = document.getElementById("levelInfo");
        const levelAnnounce = document.getElementById("levelAnnounce");
        const gameTitle = document.getElementById("gameTitle");
        const upgradeClickBtn = document.getElementById("upgradeClickBtn");
        const upgradeSlowBtn = document.getElementById("upgradeSlowBtn");
        const upgradeHelperBtn = document.getElementById("upgradeHelperBtn");
        const pauseBtn = document.getElementById("pauseBtn");
        const gameOverScreen = document.getElementById("gameOverScreen");
        const finalScoreDisplay = document.getElementById("finalScore");
        const tooltip = document.getElementById("tooltip");
        const welcomeScreen = document.getElementById("welcomeScreen");
        const header = document.getElementById("header");
        const gameArea = document.getElementById("gameArea");
        const particlesCanvas = document.getElementById("particlesCanvas");
        const startBtn = document.querySelector('#welcomeScreen .btn');
        const restartBtn = document.getElementById("restartBtn");
        const shareBtn = document.getElementById("shareBtn");

        // Canvas —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ñ–æ–Ω–æ–≤
        const starsCanvas = document.getElementById('starsCanvas');
        const lavaCanvas = document.getElementById('lavaCanvas');
        const iceCanvas = document.getElementById('iceCanvas');
        const bioCanvas = document.getElementById('bioCanvas');

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas
        function resizeCanvases() {
            const w = window.innerWidth;
            const h = window.innerHeight;
            [starsCanvas, lavaCanvas, iceCanvas, bioCanvas, particlesCanvas].forEach(c => {
                if (c) {
                    c.width = w;
                    c.height = h;
                }
            });
            
            // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤
            if (currentLocation === 'space') initStars();
            if (currentLocation === 'lava') initLava();
            if (currentLocation === 'ice') initSnow();
            if (currentLocation === 'bio') initBio();
        }
        
        resizeCanvases();
        window.addEventListener('resize', resizeCanvases);

        // === CANVAS –ê–ù–ò–ú–ê–¶–ò–ò –§–û–ù–û–í ===

        // --- –ó–í–Å–ó–î–´ (–ö–æ—Å–º–æ—Å) ---
        function initStars() {
            stars = [];
            for (let i = 0; i < 150; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 1.5;
                const distance = Math.random() * Math.max(starsCanvas.width, starsCanvas.height) * 0.8;
                
                stars.push({
                    x: starsCanvas.width / 2 + Math.cos(angle) * distance,
                    y: starsCanvas.height / 2 + Math.sin(angle) * distance,
                    size: Math.random() * 3 + 0.5,
                    speed: speed,
                    angle: angle,
                    opacity: Math.random() * 0.8 + 0.2,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed
                });
            }
        }

        function animateStars() {
            const ctx = starsCanvas.getContext('2d');
            ctx.fillStyle = 'rgba(11, 11, 29, 0.1)';
            ctx.fillRect(0, 0, starsCanvas.width, starsCanvas.height);
            
            const centerX = starsCanvas.width / 2;
            const centerY = starsCanvas.height / 2;
            
            ctx.fillStyle = '#fff';
            stars.forEach(star => {
                star.x += star.vx;
                star.y += star.vy;
                
                if (star.x < -50 || star.x > starsCanvas.width + 50 || 
                    star.y < -50 || star.y > starsCanvas.height + 50) {
                    
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 1.5;
                    
                    star.x = centerX;
                    star.y = centerY;
                    star.vx = Math.cos(angle) * speed;
                    star.vy = Math.sin(angle) * speed;
                    star.size = Math.random() * 3 + 0.5;
                    star.opacity = Math.random() * 0.8 + 0.2;
                }
                
                ctx.globalAlpha = star.opacity;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
            
            ctx.globalAlpha = 1;
            if (currentLocation === 'space') {
                requestAnimationFrame(animateStars);
            }
        }

        // --- –õ–ê–í–ê ---
        function initLava() {
            lavaParticles = [];
            for (let i = 0; i < 60; i++) {
                lavaParticles.push({
                    x: Math.random() * lavaCanvas.width,
                    y: lavaCanvas.height + Math.random() * 100,
                    size: Math.random() * 8 + 3,
                    speed: Math.random() * 3 + 1,
                    color: `hsl(${Math.random() * 20 + 10}, 80%, ${Math.random() * 30 + 50}%)`,
                    sway: (Math.random() - 0.5) * 0.5
                });
            }
        }

        function animateLava() {
            const ctx = lavaCanvas.getContext('2d');
            ctx.fillStyle = 'rgba(62, 39, 35, 0.1)';
            ctx.fillRect(0, 0, lavaCanvas.width, lavaCanvas.height);
            
            lavaParticles.forEach(p => {
                p.y -= p.speed;
                p.x += p.sway;
                
                if (p.y < -20) {
                    p.y = lavaCanvas.height + 20;
                    p.x = Math.random() * lavaCanvas.width;
                    p.speed = Math.random() * 3 + 1;
                    p.sway = (Math.random() - 0.5) * 0.5;
                }
                
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            
            if (currentLocation === 'lava') {
                requestAnimationFrame(animateLava);
            }
        }

        // --- –°–ù–ï–ì (–õ–µ–¥—è–Ω–æ–π –º–∏—Ä) ---
        function initSnow() {
            snowflakes = [];
            for (let i = 0; i < 80; i++) {
                snowflakes.push({
                    x: Math.random() * iceCanvas.width,
                    y: Math.random() * -iceCanvas.height,
                    size: Math.random() * 5 + 2,
                    speed: Math.random() * 2 + 0.5,
                    sway: Math.random() * 0.03,
                    swaySpeed: Math.random() * 0.05 + 0.02
                });
            }
        }

        function animateSnow() {
            const ctx = iceCanvas.getContext('2d');
            ctx.fillStyle = 'rgba(13, 71, 161, 0.05)';
            ctx.fillRect(0, 0, iceCanvas.width, iceCanvas.height);
            
            snowflakes.forEach(f => {
                f.y += f.speed;
                f.x += Math.sin(f.y * f.swaySpeed) * f.sway;
                
                if (f.y > iceCanvas.height) {
                    f.y = -10;
                    f.x = Math.random() * iceCanvas.width;
                    f.speed = Math.random() * 2 + 0.5;
                }
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.size, 0, Math.PI * 2);
                ctx.fill();
            });
            
            if (currentLocation === 'ice') {
                requestAnimationFrame(animateSnow);
            }
        }

        // --- –ë–ò–û–õ–ê–ë–û–†–ê–¢–û–†–ò–Ø ---
        function initBio() {
            bioDots = [];
            for (let i = 0; i < 50; i++) {
                bioDots.push({
                    x: Math.random() * bioCanvas.width,
                    y: Math.random() * bioCanvas.height,
                    size: Math.random() * 4 + 1,
                    speedX: (Math.random() - 0.5) * 1.5,
                    speedY: (Math.random() - 0.5) * 1.5,
                    color: `hsl(${Math.random() * 60 + 90}, 70%, 60%)`,
                    directionChange: Math.random() * 0.02 + 0.01,
                    changeCounter: 0
                });
            }
        }

        function animateBio() {
            const ctx = bioCanvas.getContext('2d');
            ctx.fillStyle = 'rgba(27, 94, 32, 0.05)';
            ctx.fillRect(0, 0, bioCanvas.width, bioCanvas.height);
            
            bioDots.forEach(d => {
                d.changeCounter++;
                if (d.changeCounter > 60) {
                    d.speedX += (Math.random() - 0.5) * d.directionChange;
                    d.speedY += (Math.random() - 0.5) * d.directionChange;
                    d.changeCounter = 0;
                }
                
                d.speedX = Math.max(-1.5, Math.min(1.5, d.speedX));
                d.speedY = Math.max(-1.5, Math.min(1.5, d.speedY));
                
                d.x += d.speedX;
                d.y += d.speedY;
                
                if (d.x < 0 || d.x > bioCanvas.width) d.speedX *= -1;
                if (d.y < 0 || d.y > bioCanvas.height) d.speedY *= -1;
                
                ctx.fillStyle = d.color;
                ctx.beginPath();
                ctx.arc(d.x, d.y, d.size, 0, Math.PI * 2);
                ctx.fill();
            });
            
            if (currentLocation === 'bio') {
                requestAnimationFrame(animateBio);
            }
        }

        // –õ–æ–∫–∞—Ü–∏–∏
        const locations = {
            space: { name: "üåå –ö–æ—Å–º–æ—Å", color: "#bb86fc", coinColor: "#d7ccc8", borderColor: "#4a55e0", blockColors: ['#2962ff', '#4fc3f7', '#bb86fc', '#f8bbd0'] },
            lava: { name: "üåã –õ–∞–≤–æ–≤–æ–µ —è–¥—Ä–æ", color: "#ffab91", coinColor: "#d7ccc8", borderColor: "#ff5722", blockColors: ['#ff5722', '#ff9800', '#ff5722', '#e91e63'] },
            ice: { name: "‚ùÑÔ∏è –õ–µ–¥—è–Ω–æ–π –º–∏—Ä", color: "#80deea", coinColor: "#d7ccc8", borderColor: "#0288d1", blockColors: ['#0288d1', '#29b6f6', '#00bcd4', '#00e5ff'] },
            bio: { name: "üß™ –ë–∏–æ–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", color: "#a5d6a7", coinColor: "#d7ccc8", borderColor: "#388e3c", blockColors: ['#388e3c', '#66bb6a', '#9ccc65', '#d4e157'] },
            cyber: { name: "üß† –ù–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å", color: "#ce93d8", coinColor: "#d7ccc8", borderColor: "#7b1fa2", blockColors: ['#7b1fa2', '#9c27b0', '#ab47bc', '#e1bee7'] }
        };

        // === –ù–û–í–´–ï –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò ===

        // 1. –°–ò–°–¢–ï–ú–ê –ü–û–ú–û–©–ù–ò–ö–ê
        function activateHelper() {
            if (helperActive) return;
            
            helperActive = true;
            helperTimeLeft = helperDuration;
            gameMetrics.upgradesBought++;
            
            // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∞—Ç–∞–∫–∏ –ø–æ–º–æ—â–Ω–∏–∫–∞
            helperInterval = setInterval(() => {
                if (helperActive && currentBlock && gameActive && !paused) {
                    helperAttack();
                }
            }, 1500); // –ê—Ç–∞–∫–∞ –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã
            
            // –¢–∞–π–º–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
            const helperTimer = setInterval(() => {
                if (!helperActive) {
                    clearInterval(helperTimer);
                    return;
                }
                
                helperTimeLeft -= 1000;
                updateHelperTimer();
                
                if (helperTimeLeft <= 0) {
                    helperActive = false;
                    clearInterval(helperInterval);
                    clearInterval(helperTimer);
                    updateHelperTimer();
                    updateUpgradeButtons();
                    showTooltip('–ü–æ–º–æ—â–Ω–∏–∫ –∑–∞–∫–æ–Ω—á–∏–ª —Ä–∞–±–æ—Ç—É!');
                    setTimeout(hideTooltip, 1500);
                }
            }, 1000);
            
            updateUpgradeButtons();
            playSound('helperSound');
            showTooltip('–ü–æ–º–æ—â–Ω–∏–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 1 –º–∏–Ω—É—Ç—É!');
            setTimeout(hideTooltip, 1500);
        }

        function helperAttack() {
            if (!currentBlock || !helperActive) return;
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞
            createHelperEffect();
            
            // –ù–∞–Ω–µ—Å–µ–Ω–∏–µ —É—Ä–æ–Ω–∞
            currentBlockHealth -= clickPower;
            gameMetrics.totalClicks++;
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —É–¥–∞—Ä–∞
            createDamageText(clickPower, currentBlock);
            currentBlock.textContent = currentBlockHealth;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ—â–∏–Ω
            updateCracks(currentBlock, currentBlockHealth);
            
            if (currentBlockHealth <= 0) {
                destroyBlock(currentBlock, currentLevel);
            }
            
            updateHUD();
        }

        function createHelperEffect() {
            if (!currentBlock) return;
            
            const blockRect = currentBlock.getBoundingClientRect();
            const helperX = blockRect.left + Math.random() * blockRect.width;
            const helperY = blockRect.top - 50;
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–º–æ—â–Ω–∏–∫–∞
            const helper = document.createElement('div');
            helper.className = 'helper';
            helper.style.left = helperX + 'px';
            helper.style.top = helperY + 'px';
            document.body.appendChild(helper);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ª—É—á–∞ –∞—Ç–∞–∫–∏
            const beam = document.createElement('div');
            beam.className = 'helper-beam';
            beam.style.left = (helperX + 20) + 'px';
            beam.style.top = (helperY + 40) + 'px';
            document.body.appendChild(beam);
            
            // –£–¥–∞–ª–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –∞–Ω–∏–º–∞—Ü–∏—é
            setTimeout(() => {
                if (helper.parentNode) document.body.removeChild(helper);
                if (beam.parentNode) document.body.removeChild(beam);
            }, 1000);
        }

        function updateHelperTimer() {
            if (helperTimerDisplay) {
                if (helperActive) {
                    const seconds = Math.ceil(helperTimeLeft / 1000);
                    helperTimerDisplay.textContent = `–ü–æ–º–æ—â–Ω–∏–∫: ${seconds}—Å`;
                } else {
                    helperTimerDisplay.textContent = `–ü–æ–º–æ—â–Ω–∏–∫: ‚Äî`;
                }
            }
        }

        // 2. –°–ò–°–¢–ï–ú–ê –¢–†–ï–©–ò–ù –ù–ê –ë–õ–û–ö–ê–•
        function updateCracks(block, health) {
            if (!block) return;
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ç—Ä–µ—â–∏–Ω—ã
            const existingCrack = block.querySelector('.crack-overlay');
            if (existingCrack) {
                block.removeChild(existingCrack);
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
            const maxHealth = parseInt(block.dataset.maxHealth);
            const damageRatio = 1 - (health / maxHealth);
            
            if (damageRatio > 0.7) {
                addCracks(block, 'crack-3');
            } else if (damageRatio > 0.4) {
                addCracks(block, 'crack-2');
            } else if (damageRatio > 0.1) {
                addCracks(block, 'crack-1');
            }
        }

        function addCracks(block, crackLevel) {
            const crackOverlay = document.createElement('div');
            crackOverlay.className = `crack-overlay ${crackLevel}`;
            block.appendChild(crackOverlay);
        }

        // === –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ===

        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => {});
            }
        }

        function hitBlock(block, level) {
            if (paused || !gameActive) return;
            
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            
            playSound('clickSound');
            
            block.style.transform = 'translateX(-50%) scale(0.85)';
            setTimeout(() => {
                block.style.transform = 'translateX(-50%) scale(1)';
            }, 100);
            
            currentBlockHealth -= clickPower;
            gameMetrics.totalClicks++;
            
            createDamageText(clickPower, block);
            block.textContent = currentBlockHealth;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ—â–∏–Ω –ø—Ä–∏ —É–¥–∞—Ä–µ
            updateCracks(block, currentBlockHealth);
            
            updateHUD();
            
            if (currentBlockHealth <= 0) {
                destroyBlock(block, level);
            }
        }

        function destroyBlock(block, level) {
            const now = Date.now();
            
            if (now - lastDestroyTime < COMBO_TIME_WINDOW) {
                comboCount++;
            } else {
                comboCount = 1;
            }
            lastDestroyTime = now;
            
            let reward = Math.floor(15 * Math.pow(1.15, level - 1));
            if (comboCount > 1) {
                const comboBonus = Math.floor(reward * (comboCount * 0.2));
                reward += comboBonus;
                showComboText(comboCount, comboBonus, block);
                playSound('comboSound');
            }
            
            coins += reward;
            gameMetrics.blocksDestroyed++;
            updateCoins();
            
            playSound('breakSound');
            showRewardText(reward, block);
            createExplosion(block);
            
            if (gameArea.contains(block)) {
                gameArea.removeChild(block);
            }
            currentBlock = null;
            currentBlockHealth = 0;
            
            currentLevel++;
            if (currentLevel > maxLevelReached) {
                maxLevelReached = currentLevel;
            }
            
            const locationIndex = Math.min(4, Math.floor((currentLevel - 1) / 10));
            const locationKeys = ['space', 'lava', 'ice', 'bio', 'cyber'];
            const newLocation = locationKeys[locationIndex];
            if (newLocation !== currentLocation) {
                setLocation(newLocation);
            }
            
            updateHUD();
            
            setTimeout(() => {
                if (gameActive) {
                    createMovingBlock(currentLevel);
                }
            }, 500);
        }

        function showComboText(combo, bonus, block) {
            const rect = block.getBoundingClientRect();
            const text = document.createElement('div');
            text.className = 'combo-text';
            text.textContent = `–ö–æ–º–±–æ x${combo}! +${bonus}`;
            text.style.left = (rect.left + rect.width / 2) + 'px';
            text.style.top = (rect.top) + 'px';
            
            document.body.appendChild(text);
            
            setTimeout(() => {
                if (text.parentNode) {
                    document.body.removeChild(text);
                }
            }, 1000);
        }

        function showRewardText(reward, block) {
            const rect = block.getBoundingClientRect();
            const text = document.createElement('div');
            text.className = 'reward-text';
            text.textContent = `+${reward} üíé`;
            text.style.left = (rect.left + rect.width / 2) + 'px';
            text.style.top = (rect.top + rect.height / 2) + 'px';
            
            document.body.appendChild(text);
            
            setTimeout(() => {
                if (text.parentNode) {
                    document.body.removeChild(text);
                }
            }, 1500);
        }

        function createDamageText(damage, block) {
            const rect = block.getBoundingClientRect();
            const text = document.createElement('div');
            text.className = 'damage-text';
            text.textContent = `-${damage}`;
            text.style.color = '#ff4444';
            text.style.left = (rect.left + rect.width / 2) + 'px';
            text.style.top = (rect.top) + 'px';
            
            document.body.appendChild(text);
            
            let opacity = 1;
            let yPos = parseInt(text.style.top);
            
            function animate() {
                opacity -= 0.02;
                yPos -= 2;
                text.style.opacity = opacity;
                text.style.top = yPos + 'px';
                
                if (opacity > 0) {
                    requestAnimationFrame(animate);
                } else {
                    if (text.parentNode) {
                        document.body.removeChild(text);
                    }
                }
            }
            
            animate();
        }

        const particles = [];
        
        function createExplosion(block) {
            const rect = block.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const theme = locations[currentLocation];
            
            for (let i = 0; i < 30; i++) {
                particles.push({
                    x: centerX,
                    y: centerY,
                    size: Math.random() * 4 + 1,
                    speedX: (Math.random() - 0.5) * 8,
                    speedY: (Math.random() - 0.5) * 8,
                    color: theme.blockColors[Math.floor(Math.random() * theme.blockColors.length)],
                    life: 1
                });
            }
        }

        function animateParticles() {
            if (!gameActive || !particlesCanvas) return;
            
            const ctx = particlesCanvas.getContext('2d');
            ctx.clearRect(0, 0, particlesCanvas.width, particlesCanvas.height);
            
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.speedX;
                p.y += p.speedY;
                p.life -= 0.02;
                
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
            
            requestAnimationFrame(animateParticles);
        }

        function setLocation(loc) {
            document.querySelectorAll('.location').forEach(el => el.classList.remove('active'));
            document.getElementById(`location-${loc}`).classList.add('active');
            currentLocation = loc;

            const theme = locations[loc];
            if (gameTitle) gameTitle.textContent = theme.name;
            if (pauseBtn) {
                pauseBtn.style.borderColor = theme.borderColor;
                pauseBtn.style.color = theme.color;
            }
            if (levelInfo) levelInfo.style.color = theme.color;
            if (coinsDisplay) {
                coinsDisplay.style.color = theme.coinColor;
                coinsDisplay.style.textShadow = `0 0 4px ${theme.coinColor}80`;
            }
            if (header) header.style.borderColor = theme.borderColor;
            
            switch(loc) {
                case 'space':
                    initStars();
                    animateStars();
                    break;
                case 'lava':
                    initLava();
                    animateLava();
                    break;
                case 'ice':
                    initSnow();
                    animateSnow();
                    break;
                case 'bio':
                    initBio();
                    animateBio();
                    break;
                case 'cyber':
                    break;
            }
            
            if (levelAnnounce) {
                levelAnnounce.textContent = theme.name;
                levelAnnounce.style.color = theme.color;
                levelAnnounce.style.opacity = "1";
                setTimeout(() => {
                    levelAnnounce.style.opacity = "0";
                }, 2000);
            }
        }

        function getCurrentSpeed() {
            return Math.max(5, blockSpeed - slowBonus * 2);
        }

        function updateHUD() {
            if (levelInfo) levelInfo.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${currentLevel}`;
            if (clickPowerDisplay) clickPowerDisplay.textContent = `–°–∏–ª–∞: ${clickPower}`;
            if (speedDisplay) speedDisplay.textContent = `–°–∫–æ—Ä–æ—Å—Ç—å: ${Math.round(getCurrentSpeed())}`;
            if (blockLevelDisplay) blockLevelDisplay.textContent = `–ë–ª–æ–∫: ${currentLevel}`;
            if (blockHealthDisplay) blockHealthDisplay.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${currentBlockHealth > 0 ? currentBlockHealth : '‚Äî'}`;
            updateHelperTimer();
        }

        function updateCoins() {
            if (coinsDisplay) coinsDisplay.textContent = `–ö–∞–º—É—à–∫–∏: ${Math.floor(coins).toLocaleString()}`;
            updateUpgradeButtons();
        }

        function updateUpgradeButtons() {
            const clickCost = Math.floor(baseClickUpgradeCost * Math.pow(1.5, clickUpgradeLevel));
            
            if (upgradeClickBtn) {
                if (coins >= clickCost) {
                    upgradeClickBtn.className = "upgrade-btn btn-available";
                } else {
                    upgradeClickBtn.className = "upgrade-btn btn-unavailable";
                }
            }

            if (upgradeSlowBtn) {
                if (coins >= slowCost && slowBonus === 0) {
                    upgradeSlowBtn.className = "upgrade-btn btn-available";
                } else {
                    upgradeSlowBtn.className = "upgrade-btn btn-unavailable";
                }
            }

            if (upgradeHelperBtn) {
                if (coins >= helperCost && !helperActive) {
                    upgradeHelperBtn.className = "upgrade-btn btn-available";
                } else {
                    upgradeHelperBtn.className = "upgrade-btn btn-unavailable";
                }
            }
        }

        function buyClickPower() {
            const cost = Math.floor(baseClickUpgradeCost * Math.pow(1.5, clickUpgradeLevel));
            if (coins >= cost) {
                coins -= cost;
                clickPower += 1;
                clickUpgradeLevel += 1;
                gameMetrics.upgradesBought++;
                updateCoins();
                updateHUD();
                playSound('upgradeSound');
                showTooltip(`–°–∏–ª–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞!<br>–¢–µ–ø–µ—Ä—å: ${clickPower}`);
                setTimeout(hideTooltip, 1500);
            }
        }

        function buySlow() {
            if (coins >= slowCost && slowBonus === 0) {
                coins -= slowCost;
                slowBonus += 1;
                gameMetrics.upgradesBought++;
                updateCoins();
                updateHUD();
                playSound('upgradeSound');
                showTooltip(`–°–∫–æ—Ä–æ—Å—Ç—å –±–ª–æ–∫–æ–≤ —É–º–µ–Ω—å—à–µ–Ω–∞!`);
                setTimeout(hideTooltip, 1500);
            }
        }

        function buyHelper() {
            if (coins >= helperCost && !helperActive) {
                coins -= helperCost;
                activateHelper();
                updateCoins();
            }
        }

        function showTooltip(text) {
            if (tooltip) {
                tooltip.innerHTML = text;
                tooltip.style.opacity = "1";
            }
        }

        function hideTooltip() {
            if (tooltip) tooltip.style.opacity = "0";
        }

        function createMovingBlock(level) {
            if (currentBlock && gameArea.contains(currentBlock)) {
                gameArea.removeChild(currentBlock);
            }

            const blockHealth = Math.floor(baseHealth * Math.pow(healthMultiplier, level - 1));
            currentBlockHealth = blockHealth;
            
            maxLevelReached = Math.max(maxLevelReached, level);
            
            const block = document.createElement("div");
            block.className = "moving-block";
            const size = Math.max(60, 120 - level * 0.5);
            block.style.width = size + "px";
            block.style.height = size + "px";
            block.style.bottom = "0px";
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–µ—â–∏–Ω
            block.dataset.maxHealth = blockHealth;
            
            const theme = locations[currentLocation];
            const colorIndex = level % theme.blockColors.length;
            block.style.background = `linear-gradient(135deg, ${theme.blockColors[colorIndex]}, ${theme.blockColors[(colorIndex + 1) % theme.blockColors.length]})`;
            block.style.boxShadow = `0 0 15px ${theme.blockColors[colorIndex]}`;
            block.style.border = `2px solid ${theme.borderColor}`;
            
            block.textContent = level;
            
            block.addEventListener('click', () => hitBlock(block, level));
            
            gameArea.appendChild(block);
            currentBlock = block;
            
            updateHUD();
            animateBlock(block, level);
        }

        function animateBlock(block, level) {
            if (paused || !gameActive) return;
            
            const speed = getCurrentSpeed();
            let position = parseInt(block.style.bottom) || 0;
            
            function move() {
                if (paused || !gameActive || currentBlock !== block) return;
                
                position += speed / 30;
                block.style.bottom = position + "px";
                
                if (position > window.innerHeight) {
                    gameOver();
                    return;
                }
                
                requestAnimationFrame(move);
            }
            
            move();
        }

        function gameOver() {
            gameActive = false;
            paused = false;
            helperActive = false;
            if (helperInterval) clearInterval(helperInterval);
            
            const sessionTime = Date.now() - gameMetrics.startTime;
            console.log('Session stats:', {
                time: sessionTime,
                level: maxLevelReached,
                coins: coins,
                blocks: gameMetrics.blocksDestroyed,
                upgrades: gameMetrics.upgradesBought,
                clicks: gameMetrics.totalClicks
            });
            
            localStorage.setItem('gameSessions', gameMetrics.sessions.toString());
            
            if (currentBlock && gameArea.contains(currentBlock)) {
                gameArea.removeChild(currentBlock);
                currentBlock = null;
            }
            
            if (finalScoreDisplay) {
                finalScoreDisplay.textContent = `–ú–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å: ${maxLevelReached}`;
            }
            if (gameOverScreen) {
                gameOverScreen.style.display = "flex";
            }
        }

        function togglePause() {
            if (!gameActive) return;
            paused = !paused;
            if (pauseBtn) {
                pauseBtn.textContent = paused ? "‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" : "‚è∏ –ü–∞—É–∑–∞";
            }
        }

        function shareResult() {
            const shareText = `üéÆ –Ø –¥–æ—Å—Ç–∏–≥ ${maxLevelReached} —É—Ä–æ–≤–Ω—è –∏ —Å–æ–±—Ä–∞–ª ${coins} –∫–∞–º—É—à–∫–æ–≤ –≤ –ö–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –ë–ª–æ–∫–∞—Ö! üåå\n\n–°–º–æ–∂–µ—à—å –ø–æ–±–∏—Ç—å –º–æ–π —Ä–µ–∫–æ—Ä–¥?`;
            
            if (navigator.share) {
                navigator.share({
                    title: '–ú–æ–π —Ä–µ–∫–æ—Ä–¥ –≤ –ö–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –ë–ª–æ–∫–∞—Ö!',
                    text: shareText
                }).then(() => {
                    coins += 50;
                    updateCoins();
                    showTooltip('+50 –∫–∞–º—É—à–∫–æ–≤ –∑–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ!');
                    setTimeout(hideTooltip, 2000);
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞! –ü–æ–¥–µ–ª–∏—Å—å —Å –¥—Ä—É–∑—å—è–º–∏!');
                    coins += 50;
                    updateCoins();
                });
            }
        }

        function startGame() {
            if (welcomeScreen) {
                welcomeScreen.style.display = "none";
            }
            gameActive = true;
            currentLevel = 1;
            currentBlockHealth = 0;
            comboCount = 0;
            lastDestroyTime = 0;
            helperActive = false;
            helperTimeLeft = 0;
            
            gameMetrics.startTime = Date.now();
            gameMetrics.blocksDestroyed = 0;
            gameMetrics.upgradesBought = 0;
            gameMetrics.totalClicks = 0;
            
            updateCoins();
            updateHUD();
            setLocation('space');
            animateParticles();
            setTimeout(() => createMovingBlock(currentLevel), 500);
        }

        function restartGame() {
            coins = 0;
            currentLevel = 1;
            maxLevelReached = 0;
            clickPower = 1;
            clickUpgradeLevel = 0;
            slowBonus = 0;
            paused = false;
            gameActive = true;
            comboCount = 0;
            lastDestroyTime = 0;
            helperActive = false;
            helperTimeLeft = 0;
            if (helperInterval) clearInterval(helperInterval);
            
            gameArea.innerHTML = "";
            if (gameOverScreen) gameOverScreen.style.display = "none";
            if (pauseBtn) pauseBtn.textContent = "‚è∏ –ü–∞—É–∑–∞";
            if (levelInfo) levelInfo.textContent = "–£—Ä–æ–≤–µ–Ω—å: ‚Äî";
            if (levelAnnounce) levelAnnounce.style.opacity = "0";
            
            gameMetrics.startTime = Date.now();
            gameMetrics.blocksDestroyed = 0;
            gameMetrics.upgradesBought = 0;
            gameMetrics.totalClicks = 0;
            
            setLocation('space');
            updateCoins();
            updateHUD();
            animateParticles();
            setTimeout(() => createMovingBlock(currentLevel), 500);
        }

        // –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô
        if (startBtn) {
            startBtn.addEventListener('click', startGame);
        }
        
        if (pauseBtn) {
            pauseBtn.addEventListener('click', togglePause);
        }
        
        if (upgradeClickBtn) {
            upgradeClickBtn.addEventListener('click', buyClickPower);
            upgradeClickBtn.addEventListener('mouseenter', () => showTooltip('–°–∏–ª–∞ —É–¥–∞—Ä–∞<br>+1 —É—Ä–æ–Ω'));
            upgradeClickBtn.addEventListener('mouseleave', hideTooltip);
        }
        
        if (upgradeSlowBtn) {
            upgradeSlowBtn.addEventListener('click', buySlow);
            upgradeSlowBtn.addEventListener('mouseenter', () => showTooltip('–Ø–∫–æ—Ä—å<br>‚àí2 —Å–∫–æ—Ä–æ—Å—Ç–∏'));
            upgradeSlowBtn.addEventListener('mouseleave', hideTooltip);
        }
        
        if (upgradeHelperBtn) {
            upgradeHelperBtn.addEventListener('click', buyHelper);
            upgradeHelperBtn.addEventListener('mouseenter', () => showTooltip('–ü–æ–º–æ—â–Ω–∏–∫<br>–ê–≤—Ç–æ-–∞—Ç–∞–∫–∞ –Ω–∞ 1 –º–∏–Ω—É—Ç—É'));
            upgradeHelperBtn.addEventListener('mouseleave', hideTooltip);
        }
        
        if (restartBtn) {
            restartBtn.addEventListener('click', restartGame);
        }
        
        if (shareBtn) {
            shareBtn.addEventListener('click', shareResult);
        }

        if (window.Telegram && Telegram.WebApp) {
            const tg = Telegram.WebApp;
            tg.expand();
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        updateCoins();
        updateHUD();
        setLocation('space');
        animateParticles();
    });

    // –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–Ø –ù–ê –ú–û–ë–ò–õ–¨–ù–´–•
    document.addEventListener('touchstart', function(e) {
        if (e.touches.length > 1) {
            e.preventDefault();
        }
    }, { passive: false });

    document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
    });
  </script>
</body>
</html>