// Вспомогательные функции
function formatString(template, params) {
    return template.replace(/{(\w+)}/g, (match, key) => {
        return params.hasOwnProperty(key) ? params[key] : match;
    });
}

function getDistance(x1, y1, x2, y2) {
    return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
}

function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

function showTooltip(text) {
    const tooltip = document.getElementById("tooltip");
    if (tooltip) {
        tooltip.innerHTML = text;
        tooltip.style.opacity = "1";
    }
}

function hideTooltip() {
    const tooltip = document.getElementById("tooltip");
    if (tooltip) tooltip.style.opacity = "0";
}

function playSound(soundId) {
    const sound = document.getElementById(soundId);
    if (sound) {
        sound.currentTime = 0;
        sound.play().catch(e => {});
    }
}

function updateGameMetrics() {
    const gameMetrics = {
        startTime: Date.now(),
        blocksDestroyed: 0,
        upgradesBought: 0,
        totalClicks: 0,
        sessions: 1
    };
    localStorage.setItem('gameMetrics', JSON.stringify(gameMetrics));
}

function loadGameMetrics() {
    const saved = localStorage.getItem('gameMetrics');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            return {
                startTime: data.startTime || Date.now(),
                blocksDestroyed: data.blocksDestroyed || 0,
                upgradesBought: data.upgradesBought || 0,
                totalClicks: data.totalClicks || 0,
                sessions: (data.sessions || 0) + 1
            };
        } catch (e) {
            console.warn('Ошибка загрузки метрик', e);
        }
    }
    return {
        startTime: Date.now(),
        blocksDestroyed: 0,
        upgradesBought: 0,
        totalClicks: 0,
        sessions: 1
    };
}
