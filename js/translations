// ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ñ‚Ñ€ĞµÑ… ÑĞ·Ñ‹ĞºĞ¾Ğ²
const translations = {
    ru: {
        // UI ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹
        gameTitle: {
            mercury: "â˜¿ ĞœĞµÑ€ĞºÑƒÑ€Ğ¸Ğ¹",
            venus: "â™€ Ğ’ĞµĞ½ĞµÑ€Ğ°",
            earth: "â™ Ğ—ĞµĞ¼Ğ»Ñ",
            mars: "â™‚ ĞœĞ°Ñ€Ñ",
            jupiter: "â™ƒ Ğ®Ğ¿Ğ¸Ñ‚ĞµÑ€",
            saturn: "â™„ Ğ¡Ğ°Ñ‚ÑƒÑ€Ğ½",
            uranus: "â™… Ğ£Ñ€Ğ°Ğ½",
            neptune: "â™† ĞĞµĞ¿Ñ‚ÑƒĞ½",
            pluto: "â™‡ ĞŸĞ»ÑƒÑ‚Ğ¾Ğ½"
        },
        hud: {
            coins: "ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»Ñ‹: ",
            clickPower: "Ğ¡Ğ¸Ğ»Ğ°: ",
            critChance: "ĞšÑ€Ğ¸Ñ‚: ",
            critMultiplier: "ĞœĞ½Ğ¾Ğ¶: "
        },
        progressText: "ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ: {current} / {target} Ğ°.Ğµ. ({percent}%)",
        // ĞšĞ½Ğ¾Ğ¿ĞºĞ¸
        buttons: {
            save: "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ",
            continue: "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ",
            noSave: "ĞĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ",
            start: "ĞĞ¾Ğ²Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°",
            loadSave: "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½ÑƒÑ Ğ¸Ğ³Ñ€Ñƒ",
            newGame: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¸Ğ³Ñ€Ñƒ",
            cancel: "ĞÑ‚Ğ¼ĞµĞ½Ğ°",
            restart: "ĞĞ¾Ğ²Ğ°Ñ Ğ´Ğ¾Ğ±Ñ‹Ñ‡Ğ°",
            share: "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ",
            lang: "Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº"
        },
        // Ğ­ĞºÑ€Ğ°Ğ½Ñ‹
        welcome: {
            title: "ğŸš€ ĞšĞĞ¡ĞœĞ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ ĞšĞ›Ğ˜ĞšĞ•Ğ ",
            text1: "Ğ Ğ°Ğ·Ñ€ÑƒÑˆĞ°Ğ¹Ñ‚Ğµ Ğ²Ğ¾ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ¸ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ <strong>ĞºĞ¾ÑĞ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»Ñ‹</strong>!",
            text2: "ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° ÑƒĞ´Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ.",
            text3: "<strong>Ğ ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°:</strong>",
            text4: "ğŸŒŒ <strong>ĞÑÑ‚Ñ€Ğ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹</strong> â€” Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ¿Ğ¾ Ğ¡Ğ¾Ğ»Ğ½ĞµÑ‡Ğ½Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ",
            text5: "ğŸª <strong>9 Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚</strong> â€” Ğ¾Ñ‚ ĞœĞµÑ€ĞºÑƒÑ€Ğ¸Ñ Ğ´Ğ¾ ĞŸĞ»ÑƒÑ‚Ğ¾Ğ½Ğ°",
            text6: "ğŸš€ <strong>Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ</strong> â€” ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑĞ¸Ğ»Ñƒ, ĞºÑ€Ğ¸Ñ‚Ñ‹ Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸ĞºĞ°",
            text7: "âœ¨ <strong>Ğ ĞµĞ´ĞºĞ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸</strong> â€” Ğ´Ğ°ÑÑ‚ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ Ğ¸ Ğ¾Ğ³Ñ€Ğ¾Ğ¼Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹!"
        },
        saveScreen: {
            title: "Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ• Ğ˜Ğ“Ğ Ğ«",
            text: "Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¸Ğ³Ñ€Ñ‹ Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ?"
        },
        gameOver: {
            title: "Ğ”ĞĞ‘Ğ«Ğ§Ğ ĞŸĞ Ğ•Ğ Ğ’ĞĞĞ!",
            score: "Ğ’ÑĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ½Ğ°: {damage}",
            newGame: "ĞĞ¾Ğ²Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°"
        },
        tooltips: {
            saveSuccess: "Ğ˜Ğ³Ñ€Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ°!",
            upgradeClick: "Ğ¡Ğ¸Ğ»Ğ° ÑƒĞ´Ğ°Ñ€Ğ°<br>ĞĞµĞ»Ğ¸Ğ½ĞµĞ¹Ğ½Ñ‹Ğ¹ Ñ€Ğ¾ÑÑ‚ ÑƒÑ€Ğ¾Ğ½Ğ°",
            upgradeHelper: "Bobo<br>ĞĞ²Ñ‚Ğ¾-Ğ°Ñ‚Ğ°ĞºĞ° Ğ½Ğ° 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ<br>+30% ÑƒÑ€Ğ¾Ğ½Ğ°<br>+20% Ğº ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»Ğ°Ğ¼",
            upgradeCritChance: "Ğ¨Ğ°Ğ½Ñ ĞºÑ€Ğ¸Ñ‚Ğ°<br>+0.1% ÑˆĞ°Ğ½Ñ ĞºÑ€Ğ¸Ñ‚. ÑƒÑ€Ğ¾Ğ½Ğ°",
            upgradeCritMult: "ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ°<br>+0.2x ĞºÑ€Ğ¸Ñ‚. ÑƒÑ€Ğ¾Ğ½Ğ°",
            upgradeHelperDmg: "Ğ£Ñ€Ğ¾Ğ½ Bobo<br>+20% ÑƒÑ€Ğ¾Ğ½Ğ° Ğ·Ğ° Ğ°Ğ¿Ğ³Ñ€ĞµĞ¹Ğ´",
            combo: "ĞšĞ¾Ğ¼Ğ±Ğ¾ x{count}! +{bonus}",
            reward: "+{reward} ğŸ’",
            helperAvailable: "Bobo Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ!<br>Ğ‘Ğ¾Ğ½ÑƒÑ Ğº ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»Ğ°Ğ¼: +20%",
            helperEnd: "Bobo Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ğ» Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ!",
            critChanceUpgrade: "Ğ¨Ğ°Ğ½Ñ ĞºÑ€Ğ¸Ñ‚Ğ° +0.1%!<br>Ğ¢ĞµĞ¿ĞµÑ€ÑŒ: {chance}%",
            critMultUpgrade: "ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ° +0.2x!<br>Ğ¢ĞµĞ¿ĞµÑ€ÑŒ: x{mult}",
            helperDmgUpgrade: "Ğ£Ñ€Ğ¾Ğ½ Bobo +20%!<br>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {level}",
            clickPowerUpgrade: "Ğ¡Ğ¸Ğ»Ğ° ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ°!<br>Ğ¢ĞµĞ¿ĞµÑ€ÑŒ: {power}",
            noSave: "ĞĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¸Ğ³Ñ€Ñ‹!",
            shareSuccess: "+50 ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»Ğ¾Ğ² Ğ·Ğ° Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ!"
        },
        rareBlocks: {
            gold: "Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾Ğ¹",
            rainbow: "Ğ Ğ°Ğ´ÑƒĞ¶Ğ½Ñ‹Ğ¹",
            crystal: "ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹",
            mystery: "Ğ—Ğ°Ğ³Ğ°Ğ´Ğ¾Ñ‡Ğ½Ñ‹Ğ¹"
        },
        locationProgress: {
            unlocked: "ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ° Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ: {location}!"
        }
    },
    en: {
        // UI elements
        gameTitle: {
            mercury: "â˜¿ Mercury",
            venus: "â™€ Venus",
            earth: "â™ Earth",
            mars: "â™‚ Mars",
            jupiter: "â™ƒ Jupiter",
            saturn: "â™„ Saturn",
            uranus: "â™… Uranus",
            neptune: "â™† Neptune",
            pluto: "â™‡ Pluto"
        },
        hud: {
            coins: "Crystals: ",
            clickPower: "Power: ",
            critChance: "Crit: ",
            critMultiplier: "Mult: "
        },
        progressText: "Progress: {current} / {target} a.u. ({percent}%)",
        // Buttons
        buttons: {
            save: "Save game",
            continue: "Continue",
            noSave: "No save",
            start: "New game",
            loadSave: "Continue saved game",
            newGame: "Start new game",
            cancel: "Cancel",
            restart: "New game",
            share: "Share",
            lang: "Change language"
        },
        // Screens
        welcome: {
            title: "ğŸš€ SPACE CLICKER",
            text1: "Destroy rising blocks and collect <strong>cosmic Crystals</strong>!",
            text2: "Each block requires a specific number of hits to destroy.",
            text3: "<strong>Realistic progress system:</strong>",
            text4: "ğŸŒŒ <strong>Astronomical units</strong> - travel through the Solar System",
            text5: "ğŸª <strong>9 real planets</strong> - from Mercury to Pluto",
            text6: "ğŸš€ <strong>Upgrades</strong> - increase power, crits and activate assistant",
            text7: "âœ¨ <strong>Rare blocks</strong> - provide bonuses and huge rewards!"
        },
        saveScreen: {
            title: "GAME SAVE",
            text: "Do you want to continue with the saved game or start a new one?"
        },
        gameOver: {
            title: "MINING INTERRUPTED!",
            score: "Total damage: {damage}",
            newGame: "New Game"
        },
        tooltips: {
            saveSuccess: "Game saved!",
            upgradeClick: "Click power<br>Non-linear damage growth",
            upgradeHelper: "Bobo<br>Auto-attack for 1 minute<br>+30% damage<br>+20% to crystals",
            upgradeCritChance: "Crit chance<br>+0.1% crit hit chance",
            upgradeCritMult: "Crit multiplier<br>+0.2x crit damage",
            upgradeHelperDmg: "Bobo damage<br>+20% damage per upgrade",
            combo: "Combo x{count}! +{bonus}",
            reward: "+{reward} ğŸ’",
            helperAvailable: "Bobo activated for 1 minute!<br>Crystals bonus: +20%",
            helperEnd: "Bobo has finished working!",
            critChanceUpgrade: "Crit chance +0.1%!<br>Now: {chance}%",
            critMultUpgrade: "Crit multiplier +0.2x!<br>Now: x{mult}",
            helperDmgUpgrade: "Bobo damage +20%!<br>Level: {level}",
            clickPowerUpgrade: "Power increased!<br>Now: {power}",
            noSave: "No saved game!",
            shareSuccess: "+50 Crystals for sharing!"
        },
        rareBlocks: {
            gold: "Gold",
            rainbow: "Rainbow",
            crystal: "Crystal",
            mystery: "Mystery"
        },
        locationProgress: {
            unlocked: "Unlocked location: {location}!"
        }
    },
    zh: {
        // UI elements
        gameTitle: {
            mercury: "â˜¿ æ°´æ˜Ÿ",
            venus: "â™€ é‡‘æ˜Ÿ",
            earth: "â™ åœ°çƒ",
            mars: "â™‚ ç«æ˜Ÿ",
            jupiter: "â™ƒ æœ¨æ˜Ÿ",
            saturn: "â™„ åœŸæ˜Ÿ",
            uranus: "â™… å¤©ç‹æ˜Ÿ",
            neptune: "â™† æµ·ç‹æ˜Ÿ",
            pluto: "â™‡ å†¥ç‹æ˜Ÿ"
        },
        hud: {
            coins: "æ°´æ™¶: ",
            clickPower: "åŠ›é‡: ",
            critChance: "æš´å‡»: ",
            critMultiplier: "å€æ•°: "
        },
        progressText: "è¿›åº¦: {current} / {target} å¤©æ–‡å•ä½ ({percent}%)",
        // Buttons
        buttons: {
            save: "ä¿å­˜æ¸¸æˆ",
            continue: "ç»§ç»­",
            noSave: "æ²¡æœ‰ä¿å­˜",
            start: "æ–°æ¸¸æˆ",
            loadSave: "ç»§ç»­ä¿å­˜çš„æ¸¸æˆ",
            newGame: "å¼€å§‹æ–°æ¸¸æˆ",
            cancel: "å–æ¶ˆ",
            restart: "æ–°æ¸¸æˆ",
            share: "åˆ†äº«",
            lang: "æ›´æ”¹è¯­è¨€"
        },
        // Screens
        welcome: {
            title: "ğŸš€ å¤ªç©ºç‚¹å‡»å™¨",
            text1: "æ‘§æ¯ä¸Šå‡çš„æ–¹å—å¹¶æ”¶é›†<strong>å®‡å®™æ°´æ™¶</strong>!",
            text2: "æ¯ä¸ªæ–¹å—éœ€è¦ç‰¹å®šæ¬¡æ•°çš„ç‚¹å‡»æ‰èƒ½æ‘§æ¯ã€‚",
            text3: "<strong>çœŸå®çš„è¿›åº¦ç³»ç»Ÿ:</strong>",
            text4: "ğŸŒŒ <strong>å¤©æ–‡å•ä½</strong> - åœ¨å¤ªé˜³ç³»ä¸­æ—…è¡Œ",
            text5: "ğŸª <strong>9é¢—çœŸå®è¡Œæ˜Ÿ</strong> - ä»æ°´æ˜Ÿåˆ°å†¥ç‹æ˜Ÿ",
            text6: "ğŸš€ <strong>å‡çº§</strong> - å¢åŠ åŠ›é‡, æš´å‡»å’Œæ¿€æ´»åŠ©æ‰‹",
            text7: "âœ¨ <strong>ç¨€æœ‰æ–¹å—</strong> - æä¾›å¥–åŠ±å’Œå·¨å¤§å¥–åŠ±!"
        },
        saveScreen: {
            title: "æ¸¸æˆä¿å­˜",
            text: "æ‚¨æƒ³ç»§ç»­ä¿å­˜çš„æ¸¸æˆè¿˜æ˜¯å¼€å§‹æ–°æ¸¸æˆï¼Ÿ"
        },
        gameOver: {
            title: "å¼€é‡‡ä¸­æ–­!",
            score: "æ€»ä¼¤å®³: {damage}",
            newGame: "æ–°æ¸¸æˆ"
        },
        tooltips: {
            saveSuccess: "æ¸¸æˆå·²ä¿å­˜!",
            upgradeClick: "ç‚¹å‡»åŠ›é‡<br>éçº¿æ€§ä¼¤å®³å¢é•¿",
            upgradeHelper: "Bobo<br>è‡ªåŠ¨æ”»å‡»1åˆ†é’Ÿ<br>+30%ä¼¤å®³<br>+20%æ°´æ™¶",
            upgradeCritChance: "æš´å‡»å‡ ç‡<br>+0.1%æš´å‡»å‘½ä¸­å‡ ç‡",
            upgradeCritMult: "æš´å‡»å€æ•°<br>+0.2xæš´å‡»ä¼¤å®³",
            upgradeHelperDmg: "Boboä¼¤å®³<br>+20%æ¯æ¬¡å‡çº§ä¼¤å®³",
            combo: "è¿å‡» x{count}! +{bonus}",
            reward: "+{reward} ğŸ’",
            helperAvailable: "Boboå·²æ¿€æ´»1åˆ†é’Ÿ!<br>æ°´æ™¶å¥–åŠ±: +20%",
            helperEnd: "Boboå·²å®Œæˆå·¥ä½œ!",
            critChanceUpgrade: "æš´å‡»å‡ ç‡ +0.1%!<br>ç°åœ¨: {chance}%",
            critMultUpgrade: "æš´å‡»å€æ•° +0.2x!<br>ç°åœ¨: x{mult}",
            helperDmgUpgrade: "Boboä¼¤å®³ +20%!<br>ç­‰çº§: {level}",
            clickPowerUpgrade: "åŠ›é‡å¢åŠ !<br>ç°åœ¨: {power}",
            noSave: "æ²¡æœ‰ä¿å­˜çš„æ¸¸æˆ!",
            shareSuccess: "åˆ†äº«è·å¾—+50æ°´æ™¶!"
        },
        rareBlocks: {
            gold: "é‡‘è‰²",
            rainbow: "å½©è™¹",
            crystal: "æ°´æ™¶",
            mystery: "ç¥ç§˜"
        },
        locationProgress: {
            unlocked: "è§£é”ä½ç½®: {location}!"
        }
    }
};

// Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ·Ñ‹Ğº
let currentLanguage = localStorage.getItem('gameLanguage') || 'ru';
let gameMetrics = loadGameMetrics();

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ñ€Ğ¾Ğº Ñ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼Ğ¸
function formatString(template, params) {
    return template.replace(/{(\w+)}/g, (match, key) => {
        return params.hasOwnProperty(key) ? params[key] : match;
    });
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° Ğº ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñƒ
function applyTranslation(element, keyPath, params = {}) {
    if (!element) return;
    const keys = keyPath.split('.');
    let translation = translations[currentLanguage];
    for (const key of keys) {
        if (translation && translation[key]) {
            translation = translation[key];
        } else {
            translation = undefined;
            break;
        }
    }
    if (translation === undefined) {
        console.warn(`Translation not found for ${keyPath} in ${currentLanguage}`);
        return;
    }
    element.innerHTML = formatString(translation, params);
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ÑĞµĞ³Ğ¾ UI Ğ² ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğ¸ Ñ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼ ÑĞ·Ñ‹ĞºĞ¾Ğ¼
function updateAllTranslations() {
    // Ğ­ĞºÑ€Ğ°Ğ½ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ
    applyTranslation(document.querySelector('#welcomeScreen h2'), 'welcome.title');
    const welcomeTexts = document.querySelectorAll('#welcomeScreen p');
    if (welcomeTexts.length >= 7) {
        applyTranslation(welcomeTexts[0], 'welcome.text1');
        applyTranslation(welcomeTexts[1], 'welcome.text2');
        applyTranslation(welcomeTexts[2], 'welcome.text3');
        applyTranslation(welcomeTexts[3], 'welcome.text4');
        applyTranslation(welcomeTexts[4], 'welcome.text5');
        applyTranslation(welcomeTexts[5], 'welcome.text6');
        applyTranslation(welcomeTexts[6], 'welcome.text7');
    }
    // ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ
    applyTranslation(document.getElementById('continueBtn'), 'buttons.continue');
    applyTranslation(document.getElementById('startBtn'), 'buttons.start');
    updateLangButtonTooltip();
    // Ğ­ĞºÑ€Ğ°Ğ½ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ
    applyTranslation(document.querySelector('#saveScreen h2'), 'saveScreen.title');
    applyTranslation(document.querySelector('#saveScreen p'), 'saveScreen.text');
    applyTranslation(document.getElementById('loadSaveBtn'), 'buttons.loadSave');
    applyTranslation(document.getElementById('newGameBtn'), 'buttons.newGame');
    applyTranslation(document.getElementById('cancelSaveBtn'), 'buttons.cancel');
    // Ğ­ĞºÑ€Ğ°Ğ½ Game Over
    applyTranslation(document.querySelector('#gameOverScreen h2'), 'gameOver.title');
    applyTranslation(document.getElementById('restartBtn'), 'buttons.restart');
    applyTranslation(document.getElementById('shareBtn'), 'buttons.share');
    // HUD
    applyTranslation(document.querySelector('.hud-item#coins i + span'), 'hud.coins', { value: coinsDisplay.textContent });
    applyTranslation(document.querySelector('.hud-item#clickPowerInfo i + span'), 'hud.clickPower', { value: clickPowerDisplay.textContent });
    applyTranslation(document.querySelector('.hud-item#critChanceInfo i + span'), 'hud.critChance', { value: critChanceDisplay.textContent });
    applyTranslation(document.querySelector('.hud-item#critMultiplierInfo i + span'), 'hud.critMultiplier', { value: critMultiplierDisplay.textContent });
    // ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸
    applyTranslation(document.getElementById('gameTitle'), `gameTitle.${currentLocation}`);
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğ¹
    if (document.getElementById('upgradeClickBtn')) {
        document.getElementById('upgradeClickBtn').title = translations[currentLanguage].tooltips.upgradeClick;
    }
    if (document.getElementById('upgradeHelperBtn')) {
        document.getElementById('upgradeHelperBtn').title = translations[currentLanguage].tooltips.upgradeHelper;
    }
    if (document.getElementById('upgradeCritChanceBtn')) {
        document.getElementById('upgradeCritChanceBtn').title = translations[currentLanguage].tooltips.upgradeCritChance;
    }
    if (document.getElementById('upgradeCritMultBtn')) {
        document.getElementById('upgradeCritMultBtn').title = translations[currentLanguage].tooltips.upgradeCritMult;
    }
    if (document.getElementById('upgradeHelperDmgBtn')) {
        document.getElementById('upgradeHelperDmgBtn').title = translations[currentLanguage].tooltips.upgradeHelperDmg;
    }
    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ·Ñ‹Ğº
    localStorage.setItem('gameLanguage', currentLanguage);
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€ Ñ‚ĞµĞºÑÑ‚
    const currentAU = totalDamageDealt / AU_TO_DAMAGE;
    const targetAU = locationRequirements[currentLocation].targetAU;
    const percentage = Math.min(100, (currentAU / targetAU) * 100);
    applyTranslation(document.getElementById('progressText'), 'progressText', {
        current: currentAU.toFixed(5),
        target: targetAU.toFixed(5),
        percent: percentage.toFixed(1)
    });
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ tooltip Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞ·Ñ‹ĞºĞ°
function updateLangButtonTooltip() {
    const langBtn = document.getElementById('langBtn-welcome');
    let tooltipText = '';
    switch(currentLanguage) {
        case 'ru':
            tooltipText = 'Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ·Ñ‹Ğº: Ğ ÑƒÑÑĞºĞ¸Ğ¹ (ğŸ‡·ğŸ‡·) - ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ ÑĞ¼ĞµĞ½Ñ‹ ÑĞ·Ñ‹ĞºĞ°';
            break;
        case 'en':
            tooltipText = 'Current language: English (ğŸ‡¬ğŸ‡§) - Click to change language';
            break;
        case 'zh':
            tooltipText = 'å½“å‰è¯­è¨€: ä¸­æ–‡ (ğŸ‡¨ğŸ‡³) - ç‚¹å‡»æ›´æ”¹è¯­è¨€';
            break;
    }
    if (langBtn) {
        langBtn.title = tooltipText;
    }
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ„Ğ»Ğ°Ğ³Ğ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°
function updateLanguageFlag() {
    const flagElement = document.getElementById('currentLangFlag');
    if (flagElement) {
        switch(currentLanguage) {
            case 'ru': flagElement.textContent = 'ğŸ‡·ğŸ‡·'; break; // Ğ¤Ğ»Ğ°Ğ³ Ğ Ğ¾ÑÑĞ¸Ğ¸
            case 'en': flagElement.textContent = 'ğŸ‡¬ğŸ‡§'; break; // Ğ¤Ğ»Ğ°Ğ³ Ğ’ĞµĞ»Ğ¸ĞºĞ¾Ğ±Ñ€Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğ¸
            case 'zh': flagElement.textContent = 'ğŸ‡¨ğŸ‡³'; break; // Ğ¤Ğ»Ğ°Ğ³ ĞšĞ¸Ñ‚Ğ°Ñ
        }
    }
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ°
function switchLanguage() {
    const languages = ['ru', 'en', 'zh'];
    const currentIndex = languages.indexOf(currentLanguage);
    const nextIndex = (currentIndex + 1) % languages.length;
    currentLanguage = languages[nextIndex];
    updateLanguageFlag();
    updateLangButtonTooltip();
    updateAllTranslations();
}

// Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ³Ñ€Ñ‹
let saveAvailable = false;
